---
title: "Feature Columns"
output: 
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Feature Columns}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
type: docs
repo: https://github.com/rstudio/tfestimators
menu:
  main:
    name: "Feature Columns"
    identifier: "tfestimators-feature-columns"
    parent: "tfestimators-using-tfestimators"
    weight: 40
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```

## Overview

Feature columns are used to specify how Tensors received from the input function should be combined and transformed before entering the model. A feature column can be a plain mapping to some input column (e.g. `column_numeric()` for a column of numerical data), or a transformation of other feature columns (e.g. `column_crossed()` to define a new column as the cross of two other feature columns).

Some typical mappings of R data type to feature column are:

| Data Type  | Feature Column |
|---------------------------------------|----------------------------------------------------------------|
| Numeric  |  `column_numeric()`  |
| Factor  |  `column_categorical_with_identity()` |
| Character  |  `column_categorical_with_hash_bucket()` |

For example:

```{r}
cols <- feature_columns(
  column_numeric("profit"),
  column_categorical_with_identity("profession", num_buckets = 5)
)
```

You can also define multiple feature columns at once.

```{r}
cols <- feature_columns(
  column_numeric("profit", "loss"),
  column_categorical_with_identity("profession", num_buckets = 5)
)
```

Note that when creating `feature_columns()`, the data that you pass as the first argument (`mtcars`) need not contain all of your data. The purpose of the argument is to define the set of columns against which column definitions will be matched, so it can be a small sample of your data or even just a character vector with the column names.


## Pattern Matching

**tfestimators** uses the [tidyselect](https://github.com/tidyverse/tidyselect) package to make it easy to define feature columns, similar to what you might be familiar with in the `dplyr` package. To do this, establish the set of column names to match against using the `names` argument:

```{r}
cols <- feature_columns(names = subsidiaries, 
  column_numeric("profit"),
  column_categorical_with_identity("profession", num_buckets = 5),
  column_numeric(ends_with("_pct"))
)
```

The `names` parameter can either be a character vector with the names or any R object which implements the `names()` or `colnames()` method.

If the code you are using to compose columns is more complicated, or if you need save references to columns for use in column embeddings you can also establish a scope for given set of column names using the `with_column_names()` function:

```{r}
cols <- with_column_names(names = subsidiaries, {
                        
  cols <- feature_columns(
    column_numeric("profit"),
    column_categorical_with_identity("profession", num_buckets = 5)
  )                     
     
  if (include_pct)
    cols <- feature_columns(cols, column_numeric(ends_with("_pct")))
  
  cols
})
```

Available pattern matching operators include:

| Operator | Description |
|---------------------------------------|----------------------------------------------------------------|
| `starts_with()`  | Starts with a prefix  |
| `ends_with()`  |  Ends with a suffix |
| `contains()`  |  Contains a literal string |
| `matches()`  | Matches a regular expression |
| `one_of()`  |  Included in character vector |
| `everything()`  | All columns |

See `help("select_helpers", package = "tidyselect")` for full information on the set of
helpers made available by the **tidyselect** package.



