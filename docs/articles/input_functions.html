<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Input Functions • tfestimators</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">tfestimators</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Using
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Getting Started</li>
    <li>
      <a href="../articles/using_estimators.html">Using Estimators</a>
    </li>
    <li>
      <a href="../articles/input_functions.html">Input Functions</a>
    </li>
    <li>
      <a href="../articles/feature_columns.html">Feature Columns</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/experiments.html">Experiments</a>
    </li>
    <li>
      <a href="../articles/run_hooks.html">Run Hooks</a>
    </li>
    <li>
      <a href="../articles/custom_estimators.html">Custom Estimators</a>
    </li>
    <li>
      <a href="../articles/tensorboard.html">TensorBoard Visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/examples/index.html">Examples</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/tfestimators">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Input Functions</h1>
            
          </div>

    
    
<div class="contents">
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Inputs to TensorFlow estimators are provided using an input function. Input functions take an artibrary data source (e.g. in-memory dataframe/matrix, streaming data, custom data format, etc.) and convert it into feature and label Tensors to pass on to modeling functions.</p>
<p>The main purpose of input functions is turning raw data sources into Tensors. You can also use input functions to do feature engineering, however it’s in general much better to use <a href="feature_columns.html">feature columns</a> for this purpose whenever possible, as in that case the tranformations are made part of the TensorFlow graph and can be executed without an R runtime (e.g. when the model is deployed onto a device or server).</p>
<p>The <strong>tfestimators</strong> package includes an <code><a href="../reference/input_fn.html">input_fn()</a></code> method that will create an input function automatically from an existing data frame, matrix, or list. It’s also possible to write a fully custom input function. Both methods of creating input functions are covered below.</p>
</div>
<div id="data-frame-input" class="section level2">
<h2 class="hasAnchor">
<a href="#data-frame-input" class="anchor"></a>Data Frame Input</h2>
<p>You can create an input function from an R data frame using the <code><a href="../reference/input_fn.html">input_fn()</a></code> method. You can specify feature and response variables either explicitly or using the R formula interface.</p>
<p>For example, to create an input function for the <strong>mtcars</strong> dataset with features “drat” and “cyl” and response “mpg” you could use this code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model %&gt;%<span class="st"> </span><span class="kw">train</span>(
  <span class="kw"><a href="../reference/input_fn.html">input_fn</a></span>(mtcars, <span class="dt">features =</span> <span class="kw">c</span>(drat, cyl), <span class="dt">response =</span> mpg)
)</code></pre></div>
<p>Or alternatively use the R formula interface like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model %&gt;%<span class="st"> </span><span class="kw">train</span>(
  <span class="kw"><a href="../reference/input_fn.html">input_fn</a></span>(mpg ~<span class="st"> </span>drat +<span class="st"> </span>cyl, <span class="dt">data =</span> mtcars)
)</code></pre></div>
<div id="training-vs-evaluation" class="section level3">
<h3 class="hasAnchor">
<a href="#training-vs-evaluation" class="anchor"></a>Training vs. Evaluation</h3>
<p>It’s often the case that you’ll want to use the same basic input function for training and evaluation, but need to provide a distinct dataset for each step. In that case you can create a wrapper function that returns the same input function with varying input data.</p>
<p>For example, imagine we have already split the <strong>mtcars</strong> dataset into training and test subsets. We could have an input function generator like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_input_fn &lt;-<span class="st"> </span>function(data) {
  <span class="kw"><a href="../reference/input_fn.html">input_fn</a></span>(data, <span class="dt">features =</span> <span class="kw">c</span>(drat, cyl), <span class="dt">response =</span> mpg)
}</code></pre></div>
<p>Then use it for training and evaluation as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># train the model</span>
model %&gt;%<span class="st"> </span><span class="kw">train</span>(<span class="kw">mtcars_input_fn</span>(train))

<span class="co"># evaluate the model</span>
model %&gt;%<span class="st"> </span><span class="kw">evaluate</span>(<span class="kw">mtcars_input_fn</span>(train))</code></pre></div>
</div>
</div>
<div id="matrix-input" class="section level2">
<h2 class="hasAnchor">
<a href="#matrix-input" class="anchor"></a>Matrix Input</h2>
<p>As with data frames, you can also pass an R matrix to <code><a href="../reference/input_fn.html">input_fn()</a></code> to automatically create an input function for the matrix. Note however that in order to specify the <code>features</code> and <code>response</code> parameters you will need to ensure that your matrix columns are named. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">12</span>), <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)
<span class="kw">colnames</span>(m) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"y"</span>)
<span class="kw"><a href="../reference/input_fn.html">input_fn</a></span>(m, <span class="dt">features =</span> <span class="kw">c</span>(x1, x2), <span class="dt">response =</span> y)</code></pre></div>
</div>
<div id="list-input" class="section level2">
<h2 class="hasAnchor">
<a href="#list-input" class="anchor"></a>List Input</h2>
<p>There’s also a built-in <code><a href="../reference/input_fn.html">input_fn()</a></code> that works on nested lists, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/input_fn.html">input_fn</a></span>(
  <span class="dt">object =</span> <span class="kw">list</span>(
    <span class="dt">inputs =</span> <span class="kw">list</span>(
      <span class="kw">list</span>(<span class="kw">list</span>(<span class="dv">1</span>), <span class="kw">list</span>(<span class="dv">2</span>), <span class="kw">list</span>(<span class="dv">3</span>)),
      <span class="kw">list</span>(<span class="kw">list</span>(<span class="dv">4</span>), <span class="kw">list</span>(<span class="dv">5</span>), <span class="kw">list</span>(<span class="dv">6</span>))),
    <span class="dt">output =</span> <span class="kw">list</span>(
      <span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="kw">list</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))),
  <span class="dt">features =</span> <span class="st">"inputs"</span>,
  <span class="dt">response =</span> <span class="st">"output"</span>
)</code></pre></div>
<p>In the above example, the data is a list of two named lists where each named list can be seen as different columns in a dataset. In this case, a column named <code>features</code> is being used as features to the model and a column named <code>response</code> is being used as the response variable.</p>
<p>This nested lists format is particularly useful when constructing sequence input to Recurrent Neural Networks (RNN). Once the data is defined using <code><a href="../reference/input_fn.html">input_fn()</a></code>, it can be used directly in the RNN constructor.</p>
</div>
<div id="custom-input" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-input" class="anchor"></a>Custom Input</h2>
<p>Users can also write custom input function, e.g. a function <code>custom_input_fn()</code>, to convert each feature into a <code>Tensor</code> or <code>SparseTensor</code> according to the needs. The following code illustrates the basic skeleton for an input function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_input_fn &lt;-<span class="st"> </span>function() {
  
  <span class="co"># Preprocess your data here...</span>

  <span class="co"># ...then return 1) a mapping of feature columns to Tensors with</span>
  <span class="co"># the corresponding feature data, and 2) a Tensor containing labels</span>
  <span class="kw">list</span>(feature_cols, labels)
}</code></pre></div>
<p>The body of the input function contains the specific logic for preprocessing your input data, such as reading the data from disk, scrubbing out bad examples, etc.</p>
<p>Input functions must return a list with the following two values containing the final feature and label data to be fed into your model:</p>
<dl>
<dt>feature_cols</dt>
<dd>
<p>A dict containing key/value pairs that map feature column names to Tensors (or SparseTensors) containing the corresponding feature data.</p>
</dd>
<dt>labels</dt>
<dd>
<p>A Tensor containing your label (target) values: the values your model aims to predict.</p>
</dd>
</dl>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h3>
<p>The following example demonstrates the custom input function equivalent of the <code>mtcars_input_fn()</code> in the previous section. Note that this example uses lower-level TensorFlow constructs from the <a href="https://tensorflow.rstudio.com">tensorflow</a> R package to explicitly create constant Tensors from R vectors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_input_fn &lt;-<span class="st"> </span>function(data) {
  
  <span class="kw">force</span>(data)
  
  function() {
    
    <span class="co"># named list of feature columns (convert R vectors to TF tensors)</span>
    feature_cols &lt;-<span class="st"> </span><span class="kw">list</span>(
      <span class="dt">drat =</span> tf$<span class="kw">constant</span>(data$drat),
      <span class="dt">cyl =</span> tf$<span class="kw">constant</span>(data$cyl)
    )
    
    <span class="co"># response (convert R vector to TF tensors)</span>
    response &lt;-<span class="st"> </span>tf$<span class="kw">constant</span>(data$mpg)
    
    <span class="co"># return features and response</span>
    <span class="kw">list</span>(feature_cols, response)
    
  }
  
}</code></pre></div>
<p>You’ll note that this function returns yet another function with no arguments. All input functions ultimately have this signature (no arguments) and are typically wrapped in factory functions like <code>mtcars_input_fn</code> that bind them to specific data, features, etc.</p>
<p>The use of TensorFlow is also pretty trivial here (creating constant tensors from R vectors). It’s possible to use any and all lower-level tensor manipulation APIs within custom input functions.</p>
<p>Once your custom input function is defined you can use it to provide an <code>input_fn</code> for training, evaluation, and prediction:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model %&gt;%<span class="st"> </span><span class="kw">train</span>(<span class="kw">mtcars_input_fn</span>(train))</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#data-frame-input">Data Frame Input</a></li>
      <li><a href="#matrix-input">Matrix Input</a></li>
      <li><a href="#list-input">List Input</a></li>
      <li><a href="#custom-input">Custom Input</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Yuan Tang, JJ Allaire, <a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" height="24"></a>, Kevin Ushey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
